pipeline {
    agent {
docker {
image 'python:3.11-slim'
}
}
    stages {
     stage('Install dependencies') {
            steps {
               
                sh'''
                    python3 -m pip install --upgrade pip 
                    pip3 install -r requirements.txt
                    '''
}
}
stage('run script') {
            steps {
                    sh '''
                       
                        python ip.py
                    '''
                }
            }
            stage('test') {
            steps {
                    sh '''
                       
                        python -m unittest test.py
                    '''
                }
            }
            stage('Deploy') {
    stage('Debug branch') {
    steps {
        echo "Branch detected: ${env.BRANCH_NAME}"
    }
}

    steps {
        echo 'Deploying application to EC2...'
        withCredentials([sshUserPrivateKey(credentialsId: 'my-ssh-key', keyFileVariable: 'SSH_KEY')]) {
            sh '''
                scp -i $SSH_KEY -r ./myapp ubuntu@98.81.234.38:/home/ubuntu/myapp
                ssh -i $SSH_KEY ubuntu@98.81.234.38 "/home/ubuntu/restart_myapp.sh"
            '''
        }
    }
}

       }
 }






